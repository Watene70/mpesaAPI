var Sql = require('../db/sql.js');
const axios = require('axios').default;


exports.getData = function(req,res){
   var Query = "SELECT [MAWINGU NETWORKS LTD$Sales Invoice Header].[Sell-to Customer No_],[MAWINGU NETWORKS LTD$Sales Invoice Header].[Posting Date], [MAWINGU NETWORKS LTD$Cust_ Ledger Entry].[Customer No_] FROM  [MAWINGU NETWORKS LTD$Sales Invoice Header] LEFT JOIN [MAWINGU NETWORKS LTD$Cust_ Ledger Entry] ON [MAWINGU NETWORKS LTD$Sales Invoice Header].[Sell-to Customer No_] =[MAWINGU NETWORKS LTD$Cust_ Ledger Entry].[Customer No_] WHERE [MAWINGU NETWORKS LTD$Sales Invoice Header].[Posting Date] between '02/01/2020' AND '02/29/2020' ORDER BY [MAWINGU NETWORKS LTD$Sales Invoice Header].[Sell-to Customer No_]" 
   let promise =Sql.request(Query);
   promise
   .then(function(result) {
    //    console.log(result);
       const customer = result[0][0];

       
       axios({
        method: 'POST',
        url: '/api/2.0/admin/auth/tokens',
        data:
        {
            "auth_type": "admin",
            "login": "martha",
            "password": "d64da674"
        }
        
        })
        .then(function (response) {
            console.log('response');
         res.json(response);
          if (response.status === 200) {
            console.log("Update Success");
         //    resolve();
          }
        })
        .catch((err) => {
          console.log(err.message);
         //  resolve();
        });
    },
    function(error) {
        res.send(error);
        

       axios({
        method: 'put',
        url: 'http://demo.splynx.com/api/2.0/admin/customers/customers-online/1--kill',
        data: customer,
        config: { headers: {'Content-Type': 'multipart/form-data' }}
      })
       .then(function (response) {
        res.json(response);
         if (response.status === 200) {
           console.log("Update Success");
        //    resolve();
         }
       })
       .catch((err) => {
         console.log(err.message);
        //  resolve();
       });
   },
   function(error) {
       res.send(error);
    });

 }
   
